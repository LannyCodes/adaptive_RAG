---
title: Adaptive RAG System
emoji: ðŸ¤–
colorFrom: blue
colorTo: indigo
sdk: docker
pinned: false
license: Apache License 2.0
short_description: A RAG system deployed with Docker
---

# è‡ªé€‚åº”RAGç³»ç»Ÿ - æŠ€æœ¯æ€»ç»“æ–‡æ¡£

## ðŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**è‡ªé€‚åº”æ£€ç´¢å¢žå¼ºç”Ÿæˆï¼ˆAdaptive RAGï¼‰**ç³»ç»Ÿï¼Œå®žçŽ°äº†æ™ºèƒ½æŸ¥è¯¢è·¯ç”±ã€å¤šæºä¿¡æ¯æ£€ç´¢ã€è´¨é‡ä¿è¯æµæ°´çº¿ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç³»ç»Ÿèƒ½å¤Ÿæ ¹æ®æŸ¥è¯¢å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€ä½³ä¿¡æ¯æºï¼ˆæœ¬åœ°å‘é‡æ•°æ®åº“æˆ–ç½‘ç»œæœç´¢ï¼‰ï¼Œå¹¶é€šè¿‡å¤šå±‚éªŒè¯æœºåˆ¶ç¡®ä¿ç”Ÿæˆç­”æ¡ˆçš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚

---

## ðŸ—ï¸ ç³»ç»Ÿæž¶æž„

### æ•´ä½“æž¶æž„æµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢
  â†“
æ™ºèƒ½è·¯ç”± (route_question)
  â†“
[å‘é‡å­˜å‚¨è·¯å¾„] â†â†’ [ç½‘ç»œæœç´¢è·¯å¾„]
  â†“                    â†“
æŸ¥è¯¢åˆ†è§£           ç½‘ç»œæœç´¢
(decompose_query)   (web_search)
  â†“                    â†“
å‘é‡æ£€ç´¢           ç”Ÿæˆç­”æ¡ˆ
(retrieve)          (generate)
  â†“                    â†“
æ–‡æ¡£è¯„åˆ†           è´¨é‡æ£€æŸ¥
(grade_documents)   (grade_generation)
  â†“                    â†“
å†³ç­–åˆ¤æ–­            [æœ‰ç”¨/æ— ç”¨/ä¸æ”¯æŒ]
(decide_to_generate)    â†“
  â†“                    â†“
ç”Ÿæˆç­”æ¡ˆ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(generate)
  â†“
è´¨é‡æ£€æŸ¥
(grade_generation)
  â†“
æœ€ç»ˆç­”æ¡ˆ
```

---

## ðŸ”§ æŠ€æœ¯æ ˆè¯¦ç»†åˆ†æž

### 1. æ ¸å¿ƒæ¡†æž¶å±‚

#### 1.1 LangChain & LangGraph
- **æŠ€æœ¯ç‚¹**:
  - `LangChain`: LLMåº”ç”¨ç¨‹åºç¼–æŽ’æ¡†æž¶
  - `LangGraph`: å¤æ‚å·¥ä½œæµçš„çŠ¶æ€å›¾å®žçŽ°
  - `StateGraph`: ç®¡ç†å¤æ‚RAGå·¥ä½œæµçŠ¶æ€
  - `TypedDict`: ç±»åž‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†
- **åº”ç”¨åœºæ™¯**:
  - å·¥ä½œæµèŠ‚ç‚¹å®šä¹‰å’Œç¼–æŽ’
  - çŠ¶æ€ç®¡ç†å’Œä¼ é€’
  - æ¡ä»¶åˆ†æ”¯å’Œå†³ç­–é€»è¾‘
- **å…³é”®ä»£ç ä½ç½®**: `main.py`, `workflow_nodes.py`

#### 1.2 çŠ¶æ€ç®¡ç†
- **æŠ€æœ¯ç‚¹**:
  - `GraphState` (TypedDict): å®šä¹‰å·¥ä½œæµçŠ¶æ€ç»“æž„
  - çŠ¶æ€å­—æ®µåŒ…æ‹¬: `question`, `generation`, `documents`, `retry_count`, `retrieval_metrics`, `sub_queries`, `current_query_index`, `original_question`
- **åº”ç”¨åœºæ™¯**: åœ¨å·¥ä½œæµèŠ‚ç‚¹é—´ä¼ é€’å’Œæ›´æ–°çŠ¶æ€

---

### 2. è¯­è¨€æ¨¡åž‹å±‚

#### 2.1 Ollama (æœ¬åœ°LLMæŽ¨ç†)
- **æŠ€æœ¯ç‚¹**:
  - æœ¬åœ°éƒ¨ç½²çš„LLMæŽ¨ç†å¼•æ“Ž
  - æ”¯æŒMistralã€Phiã€TinyLlamaç­‰å¤šç§æ¨¡åž‹
  - é€šè¿‡HTTP APIæä¾›æœåŠ¡ (é»˜è®¤ç«¯å£11434)
- **åº”ç”¨åœºæ™¯**:
  - æŸ¥è¯¢è·¯ç”±å†³ç­–
  - æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†
  - ç­”æ¡ˆè´¨é‡è¯„ä¼°
  - æŸ¥è¯¢åˆ†è§£å’Œé‡å†™
  - RAGç­”æ¡ˆç”Ÿæˆ
- **å…³é”®é…ç½®**: `config.py` ä¸­çš„ `LOCAL_LLM = "mistral"`
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py`, `workflow_nodes.py`

#### 2.2 ChatOllama
- **æŠ€æœ¯ç‚¹**: LangChainå¯¹Ollamaçš„å°è£…
- **åº”ç”¨åœºæ™¯**: ç»Ÿä¸€çš„LLMè°ƒç”¨æŽ¥å£

---

### 3. æ–‡æ¡£å¤„ç†å±‚

#### 3.1 æ–‡æ¡£åŠ è½½
- **æŠ€æœ¯ç‚¹**:
  - `WebBaseLoader`: ä»ŽURLåŠ è½½ç½‘ç»œå†…å®¹
  - `BeautifulSoup4`: HTMLè§£æžå’Œå†…å®¹æå–
- **åº”ç”¨åœºæ™¯**: ä»ŽæŒ‡å®šURLåŠ è½½çŸ¥è¯†åº“æ–‡æ¡£
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `load_documents()` æ–¹æ³•

#### 3.2 æ–‡æœ¬åˆ†å—
- **æŠ€æœ¯ç‚¹**:
  - `RecursiveCharacterTextSplitter`: é€’å½’å­—ç¬¦æ–‡æœ¬åˆ†å‰²å™¨
  - `tiktoken`: åŸºäºŽBPEçš„ç¼–ç å™¨ï¼Œç”¨äºŽç²¾ç¡®è®¡ç®—tokenæ•°é‡
  - åˆ†å—ç­–ç•¥: `chunk_size=250`, `chunk_overlap=50`
- **åº”ç”¨åœºæ™¯**:
  - å°†é•¿æ–‡æ¡£åˆ†å‰²æˆé€‚åˆå‘é‡åŒ–çš„å—
  - ä¿æŒä¸Šä¸‹æ–‡è¿žè´¯æ€§ï¼ˆé€šè¿‡é‡å ï¼‰
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `split_documents()` æ–¹æ³•

#### 3.3 å‘é‡åµŒå…¥
- **æŠ€æœ¯ç‚¹**:
  - `HuggingFaceEmbeddings`: ä½¿ç”¨HuggingFaceçš„åµŒå…¥æ¨¡åž‹
  - æ¨¡åž‹: `sentence-transformers/all-MiniLM-L6-v2` (è½»é‡çº§ï¼Œ384ç»´)
  - è®¾å¤‡è‡ªåŠ¨é€‰æ‹©: GPU (CUDA) æˆ– CPU
  - åµŒå…¥æ ‡å‡†åŒ–: `normalize_embeddings=True`
- **åº”ç”¨åœºæ™¯**: å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œç”¨äºŽç›¸ä¼¼åº¦æœç´¢
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `__init__()` æ–¹æ³•

---

### 4. å‘é‡æ•°æ®åº“å±‚

#### 4.1 Milvus (å‘é‡æ•°æ®åº“)
- **æŠ€æœ¯ç‚¹**:
  - **Milvus Lite**: æœ¬åœ°æ–‡ä»¶æ¨¡å¼ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•
  - **Milvus Server**: Docker/K8séƒ¨ç½²ï¼Œæ”¯æŒåˆ†å¸ƒå¼
  - **Zilliz Cloud**: äº‘æœåŠ¡æ¨¡å¼
  - ç´¢å¼•ç±»åž‹: `HNSW` (é«˜æ€§èƒ½), `IVF_FLAT` (å¹³è¡¡), `AUTOINDEX` (è‡ªåŠ¨)
  - ç´¢å¼•å‚æ•°: `M=8`, `efConstruction=64`
  - æœç´¢å‚æ•°: `ef=10` (æœç´¢èŒƒå›´)
- **åº”ç”¨åœºæ™¯**:
  - å­˜å‚¨æ–‡æ¡£å‘é‡
  - é«˜æ•ˆç›¸ä¼¼åº¦æœç´¢
  - æ”¯æŒç™¾ä¸‡çº§æ•°æ®
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `initialize_vectorstore()` æ–¹æ³•

#### 4.2 è¿žæŽ¥ç®¡ç†
- **æŠ€æœ¯ç‚¹**:
  - `pymilvus`: Milvus Pythonå®¢æˆ·ç«¯
  - è¿žæŽ¥åˆ«åç®¡ç†: `alias="default"`
  - æŒä¹…åŒ–å­˜å‚¨: `drop_old=False`
- **åº”ç”¨åœºæ™¯**: ç®¡ç†å‘é‡æ•°æ®åº“è¿žæŽ¥å’Œé›†åˆ

---

### 5. æ£€ç´¢å±‚

#### 5.1 åŸºç¡€å‘é‡æ£€ç´¢
- **æŠ€æœ¯ç‚¹**:
  - ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢
  - Top-Kæ£€ç´¢ (é»˜è®¤k=5)
  - å¼‚æ­¥æ£€ç´¢: `asimilarity_search()`
- **åº”ç”¨åœºæ™¯**: æ ¹æ®æŸ¥è¯¢å‘é‡æ‰¾åˆ°æœ€ç›¸ä¼¼çš„æ–‡æ¡£

#### 5.2 æ··åˆæ£€ç´¢ (Hybrid Search)
- **æŠ€æœ¯ç‚¹**:
  - **å‘é‡æ£€ç´¢**: åŸºäºŽè¯­ä¹‰ç›¸ä¼¼åº¦
  - **BM25æ£€ç´¢**: åŸºäºŽå…³é”®è¯åŒ¹é…
  - **æƒé‡èžåˆ**: `vector: 0.5, keyword: 0.5`
  - `rank-bm25`: BM25ç®—æ³•å®žçŽ°
  - `CustomEnsembleRetriever`: è‡ªå®šä¹‰é›†æˆæ£€ç´¢å™¨
- **åº”ç”¨åœºæ™¯**:
  - ç»“åˆè¯­ä¹‰å’Œå…³é”®è¯åŒ¹é…
  - æé«˜æ£€ç´¢å¬å›žçŽ‡
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `CustomEnsembleRetriever` ç±»

#### 5.3 æŸ¥è¯¢æ‰©å±• (Query Expansion)
- **æŠ€æœ¯ç‚¹**:
  - ä½¿ç”¨LLMç”Ÿæˆç›¸å…³æ‰©å±•æŸ¥è¯¢
  - æç¤ºæ¨¡æ¿: `QUERY_EXPANSION_PROMPT`
  - å¤šæŸ¥è¯¢å¹¶å‘æ£€ç´¢
  - ç»“æžœåŽ»é‡å’Œåˆå¹¶
- **åº”ç”¨åœºæ™¯**:
  - ä»Žä¸åŒè§’åº¦æŽ¢ç´¢æŸ¥è¯¢ä¸»é¢˜
  - æé«˜æ£€ç´¢è¦†ç›–çŽ‡
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `expand_query()` æ–¹æ³•

#### 5.4 å¤šæ¨¡æ€æ£€ç´¢
- **æŠ€æœ¯ç‚¹**:
  - `CLIPæ¨¡åž‹`: å›¾åƒ-æ–‡æœ¬è”åˆåµŒå…¥
  - æ¨¡åž‹: `openai/clip-vit-base-patch32`
  - å›¾åƒç¼–ç : å°†å›¾åƒè½¬æ¢ä¸º512ç»´å‘é‡
  - è·¨æ¨¡æ€æ£€ç´¢: æ–‡æœ¬æŸ¥è¯¢å›¾åƒï¼Œå›¾åƒæŸ¥è¯¢æ–‡æœ¬
- **åº”ç”¨åœºæ™¯**:
  - æ”¯æŒå›¾åƒå’Œæ–‡æœ¬æ··åˆæ£€ç´¢
  - å›¾åƒç›¸ä¼¼åº¦æœç´¢
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `multimodal_retrieve()` æ–¹æ³•

#### 5.5 å¤šè·³æ£€ç´¢ (Multi-hop Retrieval)
- **æŠ€æœ¯ç‚¹**:
  - æŸ¥è¯¢åˆ†è§£: å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜åºåˆ—
  - æ¡¥æŽ¥å®žä½“æå–: ä»Žä¸Šä¸€è·³ç»“æžœä¸­æå–å®žä½“ç”¨äºŽä¸‹ä¸€è·³
  - ä¸Šä¸‹æ–‡ç´¯ç§¯: åˆå¹¶å¤šè·³æ£€ç´¢ç»“æžœ
  - æ—©æœŸç»ˆæ­¢: æ£€æŸ¥æ˜¯å¦å·²èŽ·å¾—è¶³å¤Ÿä¿¡æ¯
- **åº”ç”¨åœºæ™¯**:
  - å›žç­”éœ€è¦å¤šæ­¥æŽ¨ç†çš„å¤æ‚é—®é¢˜
  - ä¾‹å¦‚: "Açš„ä½œè€…åœ¨å“ªä¸ªå¤§å­¦å·¥ä½œï¼Ÿ" â†’ åˆ†è§£ä¸º "Açš„ä½œè€…æ˜¯è°ï¼Ÿ" + "è¯¥ä½œè€…åœ¨å“ªä¸ªå¤§å­¦ï¼Ÿ"
- **å…³é”®ä»£ç ä½ç½®**: `workflow_nodes.py` çš„ `decompose_query()`, `prepare_next_query()` æ–¹æ³•

---

### 6. é‡æŽ’åºå±‚ (Reranking)

#### 6.1 CrossEncoderé‡æŽ’å™¨
- **æŠ€æœ¯ç‚¹**:
  - æ¨¡åž‹: `cross-encoder/ms-marco-MiniLM-L-6-v2`
  - è”åˆç¼–ç : æŸ¥è¯¢å’Œæ–‡æ¡£ä¸€èµ·ç¼–ç 
  - å‡†ç¡®çŽ‡æå‡: ç›¸æ¯”Bi-Encoderæå‡15-20%
  - é€‚ç”¨åœºæ™¯: ç²¾æŽ’é˜¶æ®µ (Top 20-100æ–‡æ¡£)
- **åº”ç”¨åœºæ™¯**: å¯¹åˆå§‹æ£€ç´¢ç»“æžœè¿›è¡Œç²¾ç¡®é‡æŽ’
- **å…³é”®ä»£ç ä½ç½®**: `reranker.py` çš„ `CrossEncoderReranker` ç±»

#### 6.2 å…¶ä»–é‡æŽ’ç­–ç•¥
- **TF-IDFé‡æŽ’**: åŸºäºŽè¯é¢‘-é€†æ–‡æ¡£é¢‘çŽ‡
- **BM25é‡æŽ’**: åŸºäºŽBM25ç®—æ³•
- **è¯­ä¹‰é‡æŽ’**: åŸºäºŽåµŒå…¥å‘é‡ç›¸ä¼¼åº¦
- **æ··åˆé‡æŽ’**: èžåˆå¤šç§ç­–ç•¥
- **å¤šæ ·æ€§é‡æŽ’**: MMRç®—æ³•ï¼Œé¿å…ç»“æžœé‡å¤

---

### 7. è·¯ç”±ä¸Žè¯„åˆ†å±‚

#### 7.1 æŸ¥è¯¢è·¯ç”± (Query Routing)
- **æŠ€æœ¯ç‚¹**:
  - LLM-basedè·¯ç”±å†³ç­–
  - äºŒè¿›åˆ¶é€‰æ‹©: `web_search` æˆ– `vectorstore`
  - åŸºäºŽæŸ¥è¯¢å†…å®¹è¯­ä¹‰åˆ†æž
- **åº”ç”¨åœºæ™¯**: å†³å®šä½¿ç”¨æœ¬åœ°çŸ¥è¯†åº“è¿˜æ˜¯ç½‘ç»œæœç´¢
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py` çš„ `QueryRouter` ç±»

#### 7.2 æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†
- **æŠ€æœ¯ç‚¹**:
  - LLM-basedè¯„åˆ†
  - äºŒè¿›åˆ¶è¯„åˆ†: `yes` (ç›¸å…³) æˆ– `no` (ä¸ç›¸å…³)
  - é€æ–‡æ¡£è¯„åˆ†å’Œè¿‡æ»¤
- **åº”ç”¨åœºæ™¯**: è¿‡æ»¤æŽ‰ä¸ç›¸å…³çš„æ£€ç´¢æ–‡æ¡£
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py` çš„ `DocumentGrader` ç±»

#### 7.3 ç­”æ¡ˆè´¨é‡è¯„åˆ†
- **æŠ€æœ¯ç‚¹**:
  - LLM-basedè¯„åˆ†
  - è¯„ä¼°ç­”æ¡ˆæ˜¯å¦è§£å†³äº†é—®é¢˜
  - äºŒè¿›åˆ¶è¯„åˆ†: `yes` (æœ‰ç”¨) æˆ– `no` (æ— ç”¨)
- **åº”ç”¨åœºæ™¯**: éªŒè¯ç”Ÿæˆç­”æ¡ˆçš„è´¨é‡
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py` çš„ `AnswerGrader` ç±»

#### 7.4 ç­”æ¡ˆå¯å›žç­”æ€§è¯„åˆ†
- **æŠ€æœ¯ç‚¹**:
  - è¯„ä¼°å½“å‰æ£€ç´¢æ–‡æ¡£æ˜¯å¦è¶³å¤Ÿå›žç­”é—®é¢˜
  - æ”¯æŒæ—©æœŸç»ˆæ­¢å†³ç­–
- **åº”ç”¨åœºæ™¯**: åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­æ£€ç´¢
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py` çš„ `AnswerabilityGrader` ç±»

---

### 8. å¹»è§‰æ£€æµ‹å±‚

#### 8.1 NLIæ¨¡åž‹æ£€æµ‹
- **æŠ€æœ¯ç‚¹**:
  - æ¨¡åž‹: `cross-encoder/nli-deberta-v3-xsmall` (è½»é‡çº§)
  - è‡ªç„¶è¯­è¨€æŽ¨ç† (Natural Language Inference)
  - ä¸‰ç§å…³ç³»: `entailment` (è•´å«), `contradiction` (çŸ›ç›¾), `neutral` (ä¸­ç«‹)
  - é€å¥æ£€æµ‹ + æœ€å¤§è•´å«ç­–ç•¥
- **åº”ç”¨åœºæ™¯**: æ£€æµ‹ç”Ÿæˆå†…å®¹æ˜¯å¦ä¸Žæºæ–‡æ¡£ä¸€è‡´
- **å…³é”®ä»£ç ä½ç½®**: `hallucination_detector.py` çš„ `NLIHallucinationDetector` ç±»

#### 8.2 Vectaraæ£€æµ‹æ¨¡åž‹
- **æŠ€æœ¯ç‚¹**:
  - æ¨¡åž‹: `vectara/hallucination_evaluation_model` (HHEM)
  - ä¸“é—¨è®­ç»ƒçš„å¹»è§‰æ£€æµ‹æ¨¡åž‹
  - è¾“å‡º: `factuality_score`, `hallucination_score`
- **åº”ç”¨åœºæ™¯**: é«˜ç²¾åº¦å¹»è§‰æ£€æµ‹
- **å…³é”®ä»£ç ä½ç½®**: `hallucination_detector.py` çš„ `VectaraHallucinationDetector` ç±»

#### 8.3 æ··åˆæ£€æµ‹
- **æŠ€æœ¯ç‚¹**:
  - ç»“åˆVectaraå’ŒNLIæ¨¡åž‹
  - æŠ•ç¥¨æœºåˆ¶: å¤šä¸ªæ¨¡åž‹ç»“æžœç»¼åˆåˆ¤æ–­
  - ç½®ä¿¡åº¦è®¡ç®—
- **åº”ç”¨åœºæ™¯**: æä¾›æœ€å¯é çš„å¹»è§‰æ£€æµ‹
- **å…³é”®ä»£ç ä½ç½®**: `hallucination_detector.py` çš„ `HybridHallucinationDetector` ç±»

---

### 9. æŸ¥è¯¢ä¼˜åŒ–å±‚

#### 9.1 æŸ¥è¯¢åˆ†è§£ (Query Decomposition)
- **æŠ€æœ¯ç‚¹**:
  - LLM-basedåˆ†è§£
  - å°†å¤æ‚å¤šè·³é—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜åºåˆ—
  - JSONæ ¼å¼è¾“å‡º: `{"sub_queries": [...]}`
- **åº”ç”¨åœºæ™¯**: å¤„ç†éœ€è¦å¤šæ­¥æŽ¨ç†çš„å¤æ‚æŸ¥è¯¢
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py` çš„ `QueryDecomposer` ç±»

#### 9.2 æŸ¥è¯¢é‡å†™ (Query Rewriting)
- **æŠ€æœ¯ç‚¹**:
  - LLM-basedé‡å†™
  - åŸºäºŽä¸Šä¸‹æ–‡ä¼˜åŒ–æŸ¥è¯¢è¡¨è¿°
  - æå–æ¡¥æŽ¥å®žä½“å¹¶æ³¨å…¥åˆ°ä¸‹ä¸€æŸ¥è¯¢
- **åº”ç”¨åœºæ™¯**:
  - æ”¹è¿›æ£€ç´¢æ•ˆæžœ
  - å¤šè·³æ£€ç´¢ä¸­çš„æŸ¥è¯¢ä¼˜åŒ–
- **å…³é”®ä»£ç ä½ç½®**: `routers_and_graders.py` çš„ `QueryRewriter` ç±»

---

### 10. çŸ¥è¯†å›¾è°±å±‚ (GraphRAG)

#### 10.1 å›¾è°±æž„å»º
- **æŠ€æœ¯ç‚¹**:
  - `NetworkX`: å›¾ç»“æž„ç®¡ç†
  - å®žä½“æå–: ä½¿ç”¨LLMä»Žæ–‡æ¡£ä¸­æå–å®žä½“
  - å…³ç³»æå–: æå–å®žä½“é—´å…³ç³»
  - å›¾è°±æŒä¹…åŒ–: JSONæ ¼å¼å­˜å‚¨
- **åº”ç”¨åœºæ™¯**: æž„å»ºç»“æž„åŒ–çŸ¥è¯†å›¾è°±
- **å…³é”®ä»£ç ä½ç½®**: `knowledge_graph.py` çš„ `KnowledgeGraph` ç±»

#### 10.2 ç¤¾åŒºæ£€æµ‹
- **æŠ€æœ¯ç‚¹**:
  - `python-louvain`: Louvainç¤¾åŒºæ£€æµ‹ç®—æ³•
  - å…¶ä»–ç®—æ³•: `greedy`, `label_propagation`
  - ç¤¾åŒºæ‘˜è¦: ä¸ºæ¯ä¸ªç¤¾åŒºç”Ÿæˆæ‘˜è¦
- **åº”ç”¨åœºæ™¯**:
  - å‘çŽ°çŸ¥è¯†å›¾è°±ä¸­çš„ä¸»é¢˜ç¤¾åŒº
  - æ”¯æŒå…¨å±€æŸ¥è¯¢
- **å…³é”®ä»£ç ä½ç½®**: `knowledge_graph.py` çš„ç¤¾åŒºæ£€æµ‹ç›¸å…³æ–¹æ³•

#### 10.3 å›¾è°±æ£€ç´¢
- **æŠ€æœ¯ç‚¹**:
  - æœ¬åœ°æŸ¥è¯¢: åŸºäºŽå›¾éåŽ† (æœ€å¤§è·³æ•°: 2)
  - å…¨å±€æŸ¥è¯¢: åŸºäºŽç¤¾åŒºæ‘˜è¦
  - å®žä½“é“¾æŽ¥: å°†æŸ¥è¯¢ä¸­çš„å®žä½“é“¾æŽ¥åˆ°å›¾è°±èŠ‚ç‚¹
- **åº”ç”¨åœºæ™¯**: åˆ©ç”¨ç»“æž„åŒ–çŸ¥è¯†è¿›è¡Œæ£€ç´¢
- **å…³é”®ä»£ç ä½ç½®**: `graph_retriever.py`

---

### 11. ç½‘ç»œæœç´¢å±‚

#### 11.1 Tavily API
- **æŠ€æœ¯ç‚¹**:
  - `tavily-python`: Tavilyæœç´¢APIå®¢æˆ·ç«¯
  - å®žæ—¶ç½‘ç»œæœç´¢
  - ç»“æžœæ•°é‡: `WEB_SEARCH_RESULTS_COUNT=3`
- **åº”ç”¨åœºæ™¯**: èŽ·å–æœ€æ–°ä¿¡æ¯å’Œé€šç”¨çŸ¥è¯†
- **å…³é”®ä»£ç ä½ç½®**: `workflow_nodes.py` çš„ `web_search()` æ–¹æ³•

---

### 12. è¯„ä¼°ä¸Žç›‘æŽ§å±‚

#### 12.1 æ£€ç´¢è¯„ä¼°
- **æŠ€æœ¯ç‚¹**:
  - **Precision@K**: å‰Kä¸ªç»“æžœä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹
  - **Recall@K**: å‰Kä¸ªç»“æžœè¦†ç›–çš„ç›¸å…³æ–‡æ¡£æ¯”ä¾‹
  - **MAP (Mean Average Precision)**: å¹³å‡ç²¾åº¦å‡å€¼
  - **MRR (Mean Reciprocal Rank)**: å¹³å‡å€’æ•°æŽ’å
  - **NDCG**: å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢žç›Š
  - **Latency**: æ£€ç´¢å»¶è¿Ÿ
- **åº”ç”¨åœºæ™¯**: è¯„ä¼°æ£€ç´¢ç³»ç»Ÿæ€§èƒ½
- **å…³é”®ä»£ç ä½ç½®**: `retrieval_evaluation.py` çš„ `RetrievalEvaluator` ç±»

#### 12.2 å¯è§†åŒ–
- **æŠ€æœ¯ç‚¹**:
  - `matplotlib`: ç»˜åˆ¶è¯„ä¼°æŒ‡æ ‡å›¾è¡¨
  - `seaborn`: ç»Ÿè®¡å¯è§†åŒ–
  - `pandas`: æ•°æ®å¤„ç†
- **åº”ç”¨åœºæ™¯**: å±•ç¤ºè¯„ä¼°ç»“æžœå’Œæ€§èƒ½åˆ†æž

---

### 13. å¼‚æ­¥å¤„ç†å±‚

#### 13.1 å¼‚æ­¥æ£€ç´¢
- **æŠ€æœ¯ç‚¹**:
  - `asyncio`: Pythonå¼‚æ­¥ç¼–ç¨‹
  - `asimilarity_search()`: å¼‚æ­¥ç›¸ä¼¼åº¦æœç´¢
  - `ainvoke()`: å¼‚æ­¥è°ƒç”¨
  - å¹¶å‘æŸ¥è¯¢: `asyncio.gather()`
- **åº”ç”¨åœºæ™¯**:
  - æé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦
  - å¹¶å‘å¤„ç†å¤šä¸ªæŸ¥è¯¢
- **å…³é”®ä»£ç ä½ç½®**: `document_processor.py` çš„ `async_enhanced_retrieve()` æ–¹æ³•

#### 13.2 çº¿ç¨‹æ± æ‰§è¡Œ
- **æŠ€æœ¯ç‚¹**:
  - `run_in_executor()`: åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡ŒCPUå¯†é›†åž‹ä»»åŠ¡
  - é‡æŽ’ä»»åŠ¡å¼‚æ­¥åŒ–
- **åº”ç”¨åœºæ™¯**: é¿å…é˜»å¡žä¸»äº‹ä»¶å¾ªçŽ¯

---

### 14. é…ç½®ç®¡ç†å±‚

#### 14.1 çŽ¯å¢ƒå˜é‡ç®¡ç†
- **æŠ€æœ¯ç‚¹**:
  - `python-dotenv`: åŠ è½½.envæ–‡ä»¶
  - `getpass`: å®‰å…¨è¾“å…¥APIå¯†é’¥
  - çŽ¯å¢ƒå˜é‡éªŒè¯
- **åº”ç”¨åœºæ™¯**: å®‰å…¨ç®¡ç†APIå¯†é’¥å’Œé…ç½®
- **å…³é”®ä»£ç ä½ç½®**: `config.py` çš„ `setup_environment()` æ–¹æ³•

#### 14.2 é…ç½®å‚æ•°
- **æŠ€æœ¯ç‚¹**:
  - æ¨¡åž‹é…ç½®: `LOCAL_LLM`, `EMBEDDING_MODEL`
  - åˆ†å—é…ç½®: `CHUNK_SIZE`, `CHUNK_OVERLAP`
  - å‘é‡åº“é…ç½®: `MILVUS_*` å‚æ•°
  - åŠŸèƒ½å¼€å…³: `ENABLE_GRAPHRAG`, `ENABLE_HYBRID_SEARCH`, `ENABLE_QUERY_EXPANSION`, `ENABLE_MULTIMODAL`
- **åº”ç”¨åœºæ™¯**: é›†ä¸­ç®¡ç†ç³»ç»Ÿé…ç½®

---

## ðŸ”„ å·¥ä½œæµèŠ‚ç‚¹è¯¦è§£

### èŠ‚ç‚¹1: route_question
- **åŠŸèƒ½**: æ™ºèƒ½è·¯ç”±å†³ç­–
- **æŠ€æœ¯**: LLM-basedè·¯ç”±
- **è¾“å‡º**: `"web_search"` æˆ– `"vectorstore"`

### èŠ‚ç‚¹2: decompose_query
- **åŠŸèƒ½**: æŸ¥è¯¢åˆ†è§£
- **æŠ€æœ¯**: LLM-basedåˆ†è§£
- **è¾“å‡º**: å­é—®é¢˜åˆ—è¡¨

### èŠ‚ç‚¹3: retrieve
- **åŠŸèƒ½**: æ–‡æ¡£æ£€ç´¢
- **æŠ€æœ¯**:
  - æ··åˆæ£€ç´¢ (å‘é‡ + BM25)
  - æŸ¥è¯¢æ‰©å±•
  - å¤šæ¨¡æ€æ£€ç´¢
  - é‡æŽ’åº
- **è¾“å‡º**: æ£€ç´¢åˆ°çš„æ–‡æ¡£åˆ—è¡¨

### èŠ‚ç‚¹4: grade_documents
- **åŠŸèƒ½**: æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†
- **æŠ€æœ¯**: LLM-basedè¯„åˆ†
- **è¾“å‡º**: è¿‡æ»¤åŽçš„ç›¸å…³æ–‡æ¡£

### èŠ‚ç‚¹5: decide_to_generate
- **åŠŸèƒ½**: å†³ç­–æ˜¯å¦ç”Ÿæˆç­”æ¡ˆ
- **æŠ€æœ¯**:
  - æ£€æŸ¥æ–‡æ¡£æ˜¯å¦è¶³å¤Ÿ
  - æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å­æŸ¥è¯¢
  - æ—©æœŸç»ˆæ­¢åˆ¤æ–­
- **è¾“å‡º**: `"generate"`, `"prepare_next_query"`, `"transform_query"`, æˆ– `"web_search"`

### èŠ‚ç‚¹6: prepare_next_query
- **åŠŸèƒ½**: å‡†å¤‡ä¸‹ä¸€ä¸ªå­æŸ¥è¯¢
- **æŠ€æœ¯**: æŸ¥è¯¢é‡å†™ + æ¡¥æŽ¥å®žä½“æå–
- **è¾“å‡º**: ä¼˜åŒ–åŽçš„ä¸‹ä¸€ä¸ªæŸ¥è¯¢

### èŠ‚ç‚¹7: transform_query
- **åŠŸèƒ½**: æŸ¥è¯¢è½¬æ¢
- **æŠ€æœ¯**: LLM-basedé‡å†™
- **è¾“å‡º**: æ”¹è¿›åŽçš„æŸ¥è¯¢

### èŠ‚ç‚¹8: generate
- **åŠŸèƒ½**: ç”Ÿæˆç­”æ¡ˆ
- **æŠ€æœ¯**: RAGé“¾ (Prompt + LLM)
- **è¾“å‡º**: ç”Ÿæˆçš„ç­”æ¡ˆ

### èŠ‚ç‚¹9: grade_generation_v_documents_and_question
- **åŠŸèƒ½**: ç­”æ¡ˆè´¨é‡æ£€æŸ¥
- **æŠ€æœ¯**:
- å¹»è§‰æ£€æµ‹
  - ç­”æ¡ˆè´¨é‡è¯„åˆ†
- **è¾“å‡º**: `"useful"`, `"not useful"`, æˆ– `"not supported"`

### èŠ‚ç‚¹10: web_search
- **åŠŸèƒ½**: ç½‘ç»œæœç´¢
- **æŠ€æœ¯**: Tavily API
- **è¾“å‡º**: ç½‘ç»œæœç´¢ç»“æžœ

---

## ðŸ“Š æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯

### 1. ç´¢å¼•ä¼˜åŒ–
- **HNSWç´¢å¼•**: é«˜æ€§èƒ½è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢
- **ç´¢å¼•å‚æ•°è°ƒä¼˜**: M=8, efConstruction=64
- **æœç´¢å‚æ•°è°ƒä¼˜**: ef=10

### 2. æ£€ç´¢ä¼˜åŒ–
- **æ··åˆæ£€ç´¢**: ç»“åˆè¯­ä¹‰å’Œå…³é”®è¯åŒ¹é…
- **æŸ¥è¯¢æ‰©å±•**: å¤šè§’åº¦æ£€ç´¢
- **é‡æŽ’åº**: ç²¾ç¡®æŽ’åºTop-Kç»“æžœ

### 3. å¼‚æ­¥å¤„ç†
- **å¼‚æ­¥æ£€ç´¢**: æé«˜å¹¶å‘æ€§èƒ½
- **çº¿ç¨‹æ± **: CPUå¯†é›†åž‹ä»»åŠ¡å¼‚æ­¥åŒ–

### 4. ç¼“å­˜æœºåˆ¶
- **å‘é‡åº“æŒä¹…åŒ–**: é¿å…é‡å¤å‘é‡åŒ–
- **æ–‡æ¡£åŽ»é‡**: é¿å…é‡å¤å¤„ç†

---

## ðŸ›¡ï¸ è´¨é‡ä¿è¯æœºåˆ¶

### 1. å¤šå±‚éªŒè¯
- **æ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†**: è¿‡æ»¤ä¸ç›¸å…³æ–‡æ¡£
- **ç­”æ¡ˆè´¨é‡è¯„åˆ†**: éªŒè¯ç­”æ¡ˆæœ‰ç”¨æ€§
- **å¹»è§‰æ£€æµ‹**: ç¡®ä¿ç­”æ¡ˆåŸºäºŽæºæ–‡æ¡£

### 2. è¿­ä»£æ”¹è¿›
- **æŸ¥è¯¢è½¬æ¢**: æ”¹è¿›æ£€ç´¢æ•ˆæžœ
- **é‡è¯•æœºåˆ¶**: æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶
- **å›žé€€ç­–ç•¥**: ç½‘ç»œæœç´¢ä½œä¸ºå¤‡é€‰

### 3. æ—©æœŸç»ˆæ­¢
- **ç­”æ¡ˆå¯å›žç­”æ€§æ£€æŸ¥**: é¿å…ä¸å¿…è¦çš„æ£€ç´¢
- **å¤šè·³æ£€ç´¢ä¼˜åŒ–**: æå‰ç»ˆæ­¢å·²å®Œæˆçš„ä»»åŠ¡

---

## ðŸ“¦ ä¾èµ–åº“æ€»ç»“

### æ ¸å¿ƒæ¡†æž¶
- `langchain>=0.1.0`: LLMåº”ç”¨ç¼–æŽ’
- `langgraph>=0.0.40`: å·¥ä½œæµç®¡ç†
- `langchain-community>=0.0.20`: ç¤¾åŒºé›†æˆ
- `langchain-ollama>=0.1.0`: Ollamaé›†æˆ

### å‘é‡æ•°æ®åº“
- `pymilvus[milvus_lite]>=2.4.2`: Milvuså®¢æˆ·ç«¯

### åµŒå…¥æ¨¡åž‹
- `sentence-transformers>=2.2.0`: åµŒå…¥æ¨¡åž‹
- `transformers>=4.30.0`: Transformeræ¨¡åž‹

### æ–‡æ¡£å¤„ç†
- `tiktoken>=0.5.0`: Tokenç¼–ç 
- `beautifulsoup4>=4.12.0`: HTMLè§£æž
- `rank-bm25>=0.2.2`: BM25æ£€ç´¢

### ç½‘ç»œæœç´¢
- `tavily-python>=0.3.0`: Tavily API

### å›¾å¤„ç†
- `networkx>=3.1`: å›¾ç»“æž„
- `python-louvain>=0.16`: ç¤¾åŒºæ£€æµ‹

### è¯„ä¼°ä¸Žå¯è§†åŒ–
- `scikit-learn>=1.3.0`: æœºå™¨å­¦ä¹ å·¥å…·
- `matplotlib>=3.7.0`: å¯è§†åŒ–
- `pandas>=2.0.0`: æ•°æ®å¤„ç†

### å·¥å…·åº“
- `python-dotenv>=1.0.0`: çŽ¯å¢ƒå˜é‡
- `pydantic>=2.0.0`: æ•°æ®éªŒè¯
- `numpy>=1.24.0,<2.0`: æ•°å€¼è®¡ç®—

---

## ðŸŽ¯ æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹

1. **è‡ªé€‚åº”è·¯ç”±**: æ™ºèƒ½é€‰æ‹©ä¿¡æ¯æº
2. **æ··åˆæ£€ç´¢**: è¯­ä¹‰ + å…³é”®è¯åŒé‡åŒ¹é…
3. **å¤šè·³æ£€ç´¢**: æ”¯æŒå¤æ‚æŽ¨ç†æŸ¥è¯¢
4. **ä¸“ä¸šå¹»è§‰æ£€æµ‹**: NLI + Vectaraæ¨¡åž‹
5. **æŸ¥è¯¢ä¼˜åŒ–**: åˆ†è§£ + æ‰©å±• + é‡å†™
6. **é‡æŽ’åº**: CrossEncoderç²¾ç¡®æŽ’åº
7. **å¤šæ¨¡æ€æ”¯æŒ**: æ–‡æœ¬ + å›¾åƒæ£€ç´¢
8. **å¼‚æ­¥å¤„ç†**: æé«˜ç³»ç»Ÿæ€§èƒ½
9. **è´¨é‡ä¿è¯**: å¤šå±‚éªŒè¯æœºåˆ¶
10. **GraphRAG**: ç»“æž„åŒ–çŸ¥è¯†æ£€ç´¢

---

## ðŸ“ˆ ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

- **æ£€ç´¢å‡†ç¡®çŽ‡**: Precision@3, Recall@3, MAP
- **å“åº”å»¶è¿Ÿ**: æ£€ç´¢å»¶è¿Ÿã€ç”Ÿæˆå»¶è¿Ÿ
- **å¹»è§‰æ£€æµ‹å‡†ç¡®çŽ‡**: 85-95% (ä½¿ç”¨ä¸“ä¸šæ¨¡åž‹)
- **æ”¯æŒæ•°æ®è§„æ¨¡**: ç™¾ä¸‡çº§æ–‡æ¡£
- **å¹¶å‘å¤„ç†**: å¼‚æ­¥æž¶æž„æ”¯æŒ

---

## ðŸ”® æŠ€æœ¯æ¼”è¿›æ–¹å‘

1. **æ›´å¼ºå¤§çš„åµŒå…¥æ¨¡åž‹**: æ”¯æŒæ›´å¤§è§„æ¨¡çš„åµŒå…¥
2. **æ›´æ™ºèƒ½çš„è·¯ç”±**: åŸºäºŽåŽ†å²æ•°æ®çš„è·¯ç”±ä¼˜åŒ–
3. **å®žæ—¶å­¦ä¹ **: ä»Žç”¨æˆ·åé¦ˆä¸­å­¦ä¹ 
4. **å¤šè¯­è¨€æ”¯æŒ**: æ‰©å±•åˆ°æ›´å¤šè¯­è¨€
5. **åˆ†å¸ƒå¼éƒ¨ç½²**: æ”¯æŒå¤§è§„æ¨¡åˆ†å¸ƒå¼éƒ¨ç½²

---

## ðŸ“ æ€»ç»“

æœ¬é¡¹ç›®å®žçŽ°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æŠ€æœ¯å…ˆè¿›çš„è‡ªé€‚åº”RAGç³»ç»Ÿï¼Œæ¶µç›–äº†ä»Žæ–‡æ¡£å¤„ç†ã€å‘é‡åŒ–ã€æ£€ç´¢ã€é‡æŽ’åºã€ç”Ÿæˆåˆ°è´¨é‡ä¿è¯çš„å®Œæ•´æŠ€æœ¯æ ˆã€‚ç³»ç»Ÿé‡‡ç”¨äº†å¤šç§å…ˆè¿›æŠ€æœ¯ï¼ŒåŒ…æ‹¬æ··åˆæ£€ç´¢ã€å¤šè·³æ£€ç´¢ã€ä¸“ä¸šå¹»è§‰æ£€æµ‹ã€æŸ¥è¯¢ä¼˜åŒ–ç­‰ï¼Œç¡®ä¿äº†é«˜è´¨é‡ã€é«˜å‡†ç¡®çŽ‡çš„ç­”æ¡ˆç”Ÿæˆã€‚