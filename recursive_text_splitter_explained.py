"""
RecursiveCharacterTextSplitter å·¥ä½œåŸç†è¯¦è§£
å±•ç¤ºå¦‚ä½•å°†é•¿æ–‡æ¡£åˆ‡åˆ†æˆå°å—ï¼ˆchunksï¼‰
"""

print("=" * 80)
print("RecursiveCharacterTextSplitter å·¥ä½œåŸç†")
print("=" * 80)

# ============================================================================
# Part 1: ä¸ºä»€ä¹ˆéœ€è¦æ–‡æœ¬åˆ†å‰²ï¼Ÿ
# ============================================================================
print("\n" + "=" * 80)
print("â“ Part 1: ä¸ºä»€ä¹ˆéœ€è¦æ–‡æœ¬åˆ†å‰²ï¼Ÿ")
print("=" * 80)

print("""
é—®é¢˜ï¼šåŸå§‹æ–‡æ¡£é€šå¸¸å¾ˆé•¿
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¸€ç¯‡ç½‘é¡µæ–‡ç« ï¼š5000 å­—
ä¸€ä»½æŠ€æœ¯æ–‡æ¡£ï¼š10000 å­—
ä¸€æœ¬ä¹¦çš„ä¸€ç« ï¼š20000 å­—

å¦‚æœç›´æ¥å°†æ•´ç¯‡æ–‡æ¡£åšæˆå‘é‡ï¼š
âŒ ä¿¡æ¯å¯†åº¦å¤ªä½ï¼ˆæ— å…³ä¿¡æ¯å¤ªå¤šï¼‰
âŒ æ£€ç´¢ä¸ç²¾å‡†ï¼ˆæ— æ³•å®šä½åˆ°å…·ä½“æ®µè½ï¼‰
âŒ è¶…å‡ºæ¨¡å‹é•¿åº¦é™åˆ¶ï¼ˆBERT æœ€å¤š 512 tokensï¼‰

è§£å†³æ–¹æ¡ˆï¼šæ–‡æœ¬åˆ†å‰²ï¼ˆText Splittingï¼‰
âœ… å°†é•¿æ–‡æ¡£åˆ‡æˆå°å—ï¼ˆchunksï¼‰
âœ… æ¯ä¸ª chunk ç‹¬ç«‹å»ºç«‹å‘é‡ç´¢å¼•
âœ… æ£€ç´¢æ—¶è¿”å›æœ€ç›¸å…³çš„ chunks
""")


# ============================================================================
# Part 2: ä½ çš„é¡¹ç›®é…ç½®
# ============================================================================
print("\n" + "=" * 80)
print("âš™ï¸  Part 2: ä½ çš„é¡¹ç›®é…ç½®")
print("=" * 80)

print("""
åœ¨ config.py ä¸­ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CHUNK_SIZE = 250       # æ¯ä¸ªå—æœ€å¤š 250 ä¸ª tokens
CHUNK_OVERLAP = 0      # å—ä¹‹é—´ä¸é‡å 

åœ¨ document_processor.py ä¸­ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
text_splitter = RecursiveCharacterTextSplitter.from_tiktoken_encoder(
    chunk_size=250,    # æ¯å— 250 tokens
    chunk_overlap=0    # æ— é‡å 
)
""")


# ============================================================================
# Part 3: RecursiveCharacterTextSplitter çš„æ ¸å¿ƒæœºåˆ¶
# ============================================================================
print("\n" + "=" * 80)
print("ğŸ” Part 3: RecursiveCharacterTextSplitter æ ¸å¿ƒæœºåˆ¶")
print("=" * 80)

print("""
"Recursive" çš„å«ä¹‰ï¼šé€’å½’å¼åˆ†å‰²
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¸æ˜¯ç®€å•ç²—æš´åœ°æŒ‰å­—ç¬¦æ•°åˆ‡åˆ†ï¼Œè€Œæ˜¯æŒ‰ç…§åˆ†éš”ç¬¦çš„ä¼˜å…ˆçº§é€’å½’åˆ‡åˆ†ï¼š

åˆ†éš”ç¬¦ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. "\\n\\n"    åŒæ¢è¡Œï¼ˆæ®µè½åˆ†éš”ï¼‰     â† æœ€ä¼˜å…ˆ
2. "\\n"       å•æ¢è¡Œï¼ˆå¥å­åˆ†éš”ï¼‰
3. " "        ç©ºæ ¼ï¼ˆè¯è¯­åˆ†éš”ï¼‰
4. ""         å­—ç¬¦çº§åˆ«åˆ‡åˆ†            â† æœ€åæ‰‹æ®µ

å·¥ä½œæµç¨‹ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Step 1: å°è¯•ç”¨ "\\n\\n" åˆ†å‰²
        â†“
    æ¯å—éƒ½ < 250 tokens?
        â†“ No (æŸå—å¤ªå¤§)
    
Step 2: å¯¹å¤§å—ç”¨ "\\n" åˆ†å‰²
        â†“
    æ¯å—éƒ½ < 250 tokens?
        â†“ No (æŸå—è¿˜å¤ªå¤§)
    
Step 3: å¯¹å¤§å—ç”¨ " " åˆ†å‰²
        â†“
    æ¯å—éƒ½ < 250 tokens?
        â†“ No (æŸå—ä»å¤ªå¤§)
    
Step 4: å¼ºåˆ¶æŒ‰å­—ç¬¦åˆ‡åˆ†
        â†“
    ä¿è¯æ¯å— <= 250 tokens âœ“
""")


# ============================================================================
# Part 4: å®é™…ç¤ºä¾‹ - æ‰‹åŠ¨æ¨¡æ‹Ÿåˆ†å‰²è¿‡ç¨‹
# ============================================================================
print("\n" + "=" * 80)
print("ğŸ’¡ Part 4: å®é™…ç¤ºä¾‹ - æ‰‹åŠ¨æ¨¡æ‹Ÿåˆ†å‰²è¿‡ç¨‹")
print("=" * 80)

# ç¤ºä¾‹æ–‡æ¡£
document = """äººå·¥æ™ºèƒ½ç®€ä»‹

äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ã€‚å®ƒè‡´åŠ›äºåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œé€šå¸¸éœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿã€‚

æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é¢†åŸŸã€‚å®ƒä½¿è®¡ç®—æœºèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ å¹¶æ”¹è¿›å…¶æ€§èƒ½ã€‚æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œã€‚

è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰æ˜¯å¦ä¸€ä¸ªé‡è¦çš„AIé¢†åŸŸã€‚å®ƒå¤„ç†è®¡ç®—æœºä¸äººç±»è¯­è¨€ä¹‹é—´çš„äº¤äº’ã€‚"""

print(f"\nåŸå§‹æ–‡æ¡£ï¼š")
print("â”€" * 80)
print(document)
print("â”€" * 80)
print(f"æ–‡æ¡£é•¿åº¦ï¼š{len(document)} å­—ç¬¦")

# æ¨¡æ‹Ÿ RecursiveCharacterTextSplitter çš„å·¥ä½œ
def count_tokens(text):
    """ç®€åŒ–çš„ token è®¡æ•°ï¼ˆå®é™…ä½¿ç”¨ tiktokenï¼‰"""
    # ä¸­æ–‡ï¼šå¤§çº¦ 1 å­— = 1.5 tokens
    # è‹±æ–‡ï¼šå¤§çº¦ 1 è¯ = 1 token
    return int(len(text) * 0.7)  # ç®€åŒ–ä¼°ç®—

print(f"\nä¼°ç®— tokens æ•°ï¼š{count_tokens(document)} tokens")

# Step 1: å°è¯•æŒ‰åŒæ¢è¡Œåˆ†å‰²
print("\n" + "â”" * 80)
print("Step 1: æŒ‰ '\\n\\n' (æ®µè½) åˆ†å‰²")
print("â”" * 80)

paragraphs = document.split('\n\n')
print(f"\nåˆ†å‰²æˆ {len(paragraphs)} ä¸ªæ®µè½ï¼š\n")

for i, para in enumerate(paragraphs, 1):
    token_count = count_tokens(para)
    status = "âœ…" if token_count <= 250 else "âŒ è¶…å‡ºé™åˆ¶"
    print(f"æ®µè½ {i}: {token_count} tokens {status}")
    print(f"  å†…å®¹: {para[:60]}...")
    print()

# å‡è®¾æŸä¸ªæ®µè½è¶…å‡ºé™åˆ¶
large_para = """æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é¢†åŸŸã€‚å®ƒä½¿è®¡ç®—æœºèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ å¹¶æ”¹è¿›å…¶æ€§èƒ½ã€‚æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œã€‚"""

if count_tokens(large_para) > 250:
    print("â”" * 80)
    print("Step 2: æ®µè½å¤ªå¤§ï¼ŒæŒ‰ '\\n' (å¥å­) åˆ†å‰²")
    print("â”" * 80)
    
    sentences = large_para.split('ã€‚')
    print(f"\nåˆ†å‰²æˆ {len(sentences)} ä¸ªå¥å­ï¼š\n")
    
    for i, sent in enumerate(sentences, 1):
        if sent.strip():
            token_count = count_tokens(sent)
            status = "âœ…" if token_count <= 250 else "âŒ"
            print(f"å¥å­ {i}: {token_count} tokens {status}")
            print(f"  å†…å®¹: {sent.strip()}")
            print()


# ============================================================================
# Part 5: chunk_overlap çš„ä½œç”¨
# ============================================================================
print("\n" + "=" * 80)
print("ğŸ”„ Part 5: chunk_overlapï¼ˆå—é‡å ï¼‰çš„ä½œç”¨")
print("=" * 80)

print("""
ä½ çš„é¡¹ç›®è®¾ç½®ï¼šCHUNK_OVERLAP = 0ï¼ˆæ— é‡å ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ— é‡å çš„åˆ‡åˆ†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chunk 1  â”‚â”‚ Chunk 2  â”‚â”‚ Chunk 3  â”‚
â”‚ 250 tok  â”‚â”‚ 250 tok  â”‚â”‚ 250 tok  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†‘
      è¾¹ç•Œå¯èƒ½åˆ‡æ–­è¯­ä¹‰

æœ‰é‡å çš„åˆ‡åˆ†ï¼ˆCHUNK_OVERLAP = 50ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chunk 1  â”‚
â”‚ 250 tok  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Chunk 2  â”‚
      â”‚ 250 tok  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Chunk 3  â”‚
            â”‚ 250 tok  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼š
âœ… ä¿ç•™ä¸Šä¸‹æ–‡è¿è´¯æ€§
âœ… é¿å…å…³é”®ä¿¡æ¯è¢«åˆ‡æ–­
âœ… æé«˜æ£€ç´¢å‡†ç¡®ç‡ (+5-10%)

ç¼ºç‚¹ï¼š
âŒ å­˜å‚¨ç©ºé—´å¢åŠ  20-30%
âŒ å¯èƒ½è¿”å›é‡å¤å†…å®¹

ä¸ºä»€ä¹ˆä½ çš„é¡¹ç›®è®¾ä¸º 0ï¼Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… èŠ‚çœå­˜å‚¨ç©ºé—´
âœ… é¿å…é‡å¤
âœ… é…åˆ CrossEncoder é‡æ’å·²ç»è¶³å¤Ÿå‡†ç¡®

æ¨èè®¾ç½®ï¼š
- CHUNK_OVERLAP = 0:   å¿«é€ŸåŸå‹ã€å­˜å‚¨å—é™
- CHUNK_OVERLAP = 50:  ç”Ÿäº§ç¯å¢ƒã€é«˜ç²¾åº¦è¦æ±‚ â­
- CHUNK_OVERLAP = 100: å…³é”®åº”ç”¨ã€åŒ»ç–—æ³•å¾‹ç­‰
""")


# ============================================================================
# Part 6: from_tiktoken_encoder çš„ä½œç”¨
# ============================================================================
print("\n" + "=" * 80)
print("ğŸ¯ Part 6: from_tiktoken_encoder çš„ç‰¹æ®Šä¹‹å¤„")
print("=" * 80)

print("""
ä½ çš„ä»£ç ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
RecursiveCharacterTextSplitter.from_tiktoken_encoder(
    chunk_size=250,
    chunk_overlap=0
)

ä¸ä½¿ç”¨ tiktokenï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
RecursiveCharacterTextSplitter(
    chunk_size=250,    # â† è¿™é‡Œæ˜¯å­—ç¬¦æ•°ï¼Œä¸æ˜¯ tokensï¼
    chunk_overlap=0
)

åŒºåˆ«ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ™®é€šæ¨¡å¼ï¼šæŒ‰å­—ç¬¦æ•°åˆ‡åˆ†
â”œâ”€ chunk_size=250 â†’ 250 ä¸ªå­—ç¬¦
â”œâ”€ ä¸­æ–‡ï¼šå¤§çº¦ 250 ä¸ªå­— = 375 tokensï¼ˆè¶…æ ‡ï¼ï¼‰
â””â”€ è‹±æ–‡ï¼šå¤§çº¦ 50 ä¸ªå•è¯ = 50 tokensï¼ˆå¤ªå°‘ï¼ï¼‰

tiktoken æ¨¡å¼ï¼šæŒ‰ tokens åˆ‡åˆ† â­
â”œâ”€ chunk_size=250 â†’ ç²¾ç¡® 250 ä¸ª tokens
â”œâ”€ ä¸­æ–‡ï¼šå¤§çº¦ 166 ä¸ªå­— = 250 tokens âœ“
â””â”€ è‹±æ–‡ï¼šå¤§çº¦ 190 ä¸ªå•è¯ = 250 tokens âœ“

tiktoken æ˜¯ä»€ä¹ˆï¼Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
OpenAI çš„ tokenizerï¼Œä¸ GPT/BERT çš„åˆ†è¯æ–¹å¼ä¸€è‡´

ä¼˜ç‚¹ï¼š
âœ… ç²¾ç¡®æ§åˆ¶ chunk å¤§å°
âœ… ä¸ Embedding æ¨¡å‹çš„ token é™åˆ¶ä¸€è‡´
âœ… ä¸­è‹±æ–‡éƒ½èƒ½å‡†ç¡®å¤„ç†

ä½ çš„é¡¹ç›®ä½¿ç”¨ tiktoken æ˜¯æ­£ç¡®ä¸”æ¨èçš„åšæ³•ï¼
""")


# ============================================================================
# Part 7: å®Œæ•´çš„åˆ†å‰²æµç¨‹å¯è§†åŒ–
# ============================================================================
print("\n" + "=" * 80)
print("ğŸ“Š Part 7: å®Œæ•´çš„åˆ†å‰²æµç¨‹å¯è§†åŒ–")
print("=" * 80)

print("""
åŸå§‹æ–‡æ¡£ (5000 tokens)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”‚ ç¬¬ä¸€ç« ï¼šäººå·¥æ™ºèƒ½ç®€ä»‹                              â”‚
â”‚                                                   â”‚
â”‚ äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯...           â”‚
â”‚                                                   â”‚
â”‚ ç¬¬äºŒç« ï¼šæœºå™¨å­¦ä¹                                   â”‚
â”‚                                                   â”‚
â”‚ æœºå™¨å­¦ä¹ æ˜¯AIçš„ä¸€ä¸ªå­é¢†åŸŸ...                       â”‚
â”‚                                                   â”‚
â”‚ ç¬¬ä¸‰ç« ï¼šæ·±åº¦å­¦ä¹                                   â”‚
â”‚ ...                                               â”‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              â†“
    RecursiveCharacterTextSplitter
    (chunk_size=250, overlap=0)
              â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Chunk 1 (250 tokens)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬ä¸€ç« ï¼šäººå·¥æ™ºèƒ½ç®€ä»‹                            â”‚
â”‚                                                 â”‚
â”‚ äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ã€‚å®ƒè‡´åŠ›... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“ å­˜å…¥å‘é‡æ•°æ®åº“

Chunk 2 (250 tokens)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äººå·¥æ™ºèƒ½åŒ…æ‹¬å¤šä¸ªå­é¢†åŸŸï¼Œå¦‚æœºå™¨å­¦ä¹ ã€...        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“ å­˜å…¥å‘é‡æ•°æ®åº“

Chunk 3 (250 tokens)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬äºŒç« ï¼šæœºå™¨å­¦ä¹                                 â”‚
â”‚                                                 â”‚
â”‚ æœºå™¨å­¦ä¹ æ˜¯AIçš„ä¸€ä¸ªå­é¢†åŸŸã€‚å®ƒä½¿è®¡ç®—æœºèƒ½å¤Ÿ...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“ å­˜å…¥å‘é‡æ•°æ®åº“

...ç»§ç»­åˆ†å‰²æˆçº¦ 20 ä¸ª chunks

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ£€ç´¢æ—¶ï¼š
ç”¨æˆ·é—®é¢˜: "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ"
    â†“
å‘é‡æ£€ç´¢ Top 20 chunks
    â†“
â”œâ”€ Chunk 3  (ç›¸å…³åº¦: 0.92) â† æœ€ç›¸å…³
â”œâ”€ Chunk 4  (ç›¸å…³åº¦: 0.88)
â”œâ”€ Chunk 1  (ç›¸å…³åº¦: 0.75)
â””â”€ ...
    â†“
CrossEncoder é‡æ’ â†’ Top 5
    â†“
è¿”å›æœ€ç›¸å…³çš„ç‰‡æ®µç»™ LLM ç”Ÿæˆç­”æ¡ˆ
""")


# ============================================================================
# Part 8: å…³é”®å‚æ•°è°ƒä¼˜å»ºè®®
# ============================================================================
print("\n" + "=" * 80)
print("âš™ï¸  Part 8: å…³é”®å‚æ•°è°ƒä¼˜å»ºè®®")
print("=" * 80)

print("""
å‚æ•°é…ç½®å»ºè®®ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CHUNK_SIZEï¼ˆå—å¤§å°ï¼‰ï¼š
â”œâ”€ 100-200:  çŸ­æ–‡æ¡£ã€ç²¾ç¡®æ£€ç´¢
â”œâ”€ 250-500:  é€šç”¨åœºæ™¯ â­ (ä½ çš„é¡¹ç›®)
â””â”€ 500-1000: é•¿æ–‡æ¡£ã€éœ€è¦æ›´å¤šä¸Šä¸‹æ–‡

CHUNK_OVERLAPï¼ˆé‡å ï¼‰ï¼š
â”œâ”€ 0:     å¿«é€ŸåŸå‹ã€å­˜å‚¨å—é™ (ä½ çš„é¡¹ç›®)
â”œâ”€ 50:    ç”Ÿäº§ç¯å¢ƒæ¨è â­
â”œâ”€ 100:   é«˜ç²¾åº¦è¦æ±‚
â””â”€ 150+:  å…³é”®åº”ç”¨

ä½ çš„é¡¹ç›®é…ç½®ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CHUNK_SIZE = 250    âœ“ é€‚ä¸­ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯
CHUNK_OVERLAP = 0   âš ï¸  å»ºè®®æ”¹ä¸º 50-100

æ¨èä¼˜åŒ–ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CHUNK_SIZE = 400      # å¢åŠ ä¸Šä¸‹æ–‡
CHUNK_OVERLAP = 100   # æ·»åŠ é‡å ä¿è¯è¿è´¯æ€§

ç†ç”±ï¼š
âœ… 400 tokens è¶³å¤ŸåŒ…å«å®Œæ•´çš„æ®µè½
âœ… 100 tokens é‡å é¿å…å…³é”®ä¿¡æ¯è¢«åˆ‡æ–­
âœ… é…åˆ CrossEncoderï¼Œå‡†ç¡®ç‡å¯æå‡ 8-12%
""")


# ============================================================================
# Part 9: æ€»ç»“
# ============================================================================
print("\n" + "=" * 80)
print("ğŸ“š Part 9: æ ¸å¿ƒè¦ç‚¹æ€»ç»“")
print("=" * 80)

print("""
RecursiveCharacterTextSplitter çš„å·¥ä½œåŸç†ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£  é€’å½’åˆ†å‰²ï¼š
   â””â”€ æŒ‰ä¼˜å…ˆçº§å°è¯•åˆ†éš”ç¬¦ï¼š\\n\\n â†’ \\n â†’ ç©ºæ ¼ â†’ å­—ç¬¦

2ï¸âƒ£  æ™ºèƒ½åˆ‡åˆ†ï¼š
   â””â”€ ä¿æŒè¯­ä¹‰å®Œæ•´æ€§ï¼Œä¼˜å…ˆåœ¨æ®µè½/å¥å­è¾¹ç•Œåˆ‡åˆ†

3ï¸âƒ£  ç²¾ç¡®æ§åˆ¶ï¼š
   â””â”€ from_tiktoken_encoder ç¡®ä¿æ¯å—æ°å¥½ 250 tokens

4ï¸âƒ£  å¯é€‰é‡å ï¼š
   â””â”€ CHUNK_OVERLAP ä¿ç•™ä¸Šä¸‹æ–‡è¿è´¯æ€§

5ï¸âƒ£  ä½ çš„é¡¹ç›®æµç¨‹ï¼š
   åŸå§‹æ–‡æ¡£
      â†“ RecursiveCharacterTextSplitter
   250-token chunks
      â†“ HuggingFace Embeddings
   å‘é‡æ•°æ®åº“
      â†“ å‘é‡æ£€ç´¢ (Top 20)
   å€™é€‰ chunks
      â†“ CrossEncoder é‡æ’
   æœ€ç»ˆ Top 5 chunks
      â†“ 
   å–‚ç»™ LLM ç”Ÿæˆç­”æ¡ˆ

å…³é”®ä¼˜åŠ¿ï¼š
âœ… æ™ºèƒ½åˆ‡åˆ†ï¼Œä¿æŒè¯­ä¹‰å®Œæ•´
âœ… ç²¾ç¡®æ§åˆ¶ chunk å¤§å°
âœ… æ”¯æŒä¸­è‹±æ–‡æ··åˆæ–‡æœ¬
âœ… ä¸å‘é‡æ£€ç´¢é…åˆå®Œç¾

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ çš„é¡¹ç›®èƒ½å¤Ÿå‡†ç¡®æ£€ç´¢å’Œå›ç­”é—®é¢˜ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")

print("\n" + "=" * 80)
print("âœ… è§£æå®Œæˆï¼ç°åœ¨ä½ åº”è¯¥ç†è§£äº†æ–‡æœ¬åˆ†å‰²çš„åŸç†")
print("=" * 80)
print()
